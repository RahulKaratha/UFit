# üìã AI-Based Workout Planner ‚Äì MongoDB Schema

This document describes the MongoDB database schema for the **AI-Based Workout Planner with Fuzzy Logic**, implemented using **Mongoose**.  
The schema is optimized for the **MERN stack**, following **NoSQL best practices** with a balance of embedding and referencing.

---

## üèóÔ∏è Collections & Schemas

### 1. User
Handles **authentication** and core identity information.

```js
const UserSchema = new mongoose.Schema({
  email: { type: String, required: true, unique: true, index: true },
  passwordHash: { type: String, required: true },
  createdAt: { type: Date, default: Date.now }
});
```

‚úÖ **Indexes**:  
- `email` is indexed and unique for fast lookups during login.  

---

### 2. UserProfile
Stores detailed fitness-related information for a user.  
Kept in a **separate collection** (instead of embedding in User) because:
- The profile can grow over time (extra fields, preferences, biometrics).
- Profiles are frequently read when generating workouts.
- Separation keeps the `User` document small for fast authentication queries.

```js
const UserProfileSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, index: true },
  goals: { type: [String], enum: ["Strength", "Fat Loss", "Endurance", "Flexibility"], required: true },
  fitnessLevel: { type: String, enum: ["Beginner", "Intermediate", "Advanced"], required: true },
  age: Number,
  weight: Number,
  height: Number,
  createdAt: { type: Date, default: Date.now }
});
```

‚úÖ **Indexes**:  
- `userId` for quick joins with User.  

---

### 3. Workout
Represents a **daily workout plan** generated by the AI for each user.  
Exercises are **embedded** because:
- Workouts are usually queried as a whole.
- Exercises are tightly coupled to a workout (rarely queried independently).

```js
const ExerciseSchema = new mongoose.Schema({
  exerciseName: { type: String, required: true },
  sets: Number,
  reps: Number,
  weight: Number,
  restPeriodInSeconds: Number
}, { _id: false });

const WorkoutSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, index: true },
  date: { type: Date, required: true, index: true },
  status: { type: String, enum: ["pending", "completed", "skipped"], default: "pending" },
  exercises: [ExerciseSchema]
});
```

‚úÖ **Indexes**:  
- `(userId, date)` compound index for retrieving a user‚Äôs workout history sorted by date.  

---

### 4. WorkoutFeedback
Stores **feedback for each workout**.  
Kept in a **separate collection** because:
- Feedback is used for analytics, fuzzy logic, and historical trend analysis.
- Decoupling allows querying all feedback without pulling entire workout documents.

```js
const WorkoutFeedbackSchema = new mongoose.Schema({
  userId: { type: mongoose.Schema.Types.ObjectId, ref: "User", required: true, index: true },
  workoutId: { type: mongoose.Schema.Types.ObjectId, ref: "Workout", required: true, unique: true },
  rating: { type: String, enum: ["Too Easy", "Moderate", "Too Hard"], required: true },
  notes: String,
  fuzzyScore: { type: Number, min: 1, max: 10, required: true },
  createdAt: { type: Date, default: Date.now }
});
```

‚úÖ **Indexes**:  
- `workoutId` unique index ensures **one feedback per workout**.  

---

## üîÑ Key Workflows Supported

1. **Onboarding**
   - `User` created on signup.
   - `UserProfile` created for goals, fitness level, and metrics.

2. **Workout Generation**
   - Fetch `UserProfile` and last 7 days of `Workout` + `WorkoutFeedback`.
   - Create a new `Workout` document for today with status = `pending`.

3. **Feedback Loop**
   - User submits `WorkoutFeedback` ‚Üí stored in collection.
   - Linked `Workout` document status is updated to `completed`.

4. **Skipped Days**
   - Workouts not performed have status updated to `skipped`.

5. **Progress Tracking**
   - Fetch all `Workout` + `WorkoutFeedback` for a user.
   - Generate charts for **frequency, skipped days, intensity (fuzzy score)**.

---

## üìä Design Justifications

- **User vs. UserProfile (One-to-One)**
  - Separated into different collections for flexibility and performance.
  - `User` remains lean (auth-focused), while `UserProfile` can evolve with fitness-related attributes.

- **Workout vs. WorkoutFeedback (One-to-One)**
  - Kept in separate collections for **analytics scalability**.
  - Embedding feedback would simplify lookups but make analytical queries more costly.

- **Embedding vs. Referencing**
  - **Exercises embedded** inside `Workout` (tightly coupled).
  - **Profiles and feedback referenced** (decoupled, useful across queries and analytics).

---

## ‚ö° Indexing Strategy
- `User.email` ‚Üí unique index (auth).
- `UserProfile.userId` ‚Üí index for fast lookup.
- `Workout.userId + date` ‚Üí compound index for history queries.
- `WorkoutFeedback.workoutId` ‚Üí unique index (one feedback per workout).

---

## ‚úÖ Conclusion
This schema design balances **performance, scalability, and flexibility**:  
- Lean auth collection (`User`).  
- Extendable fitness details (`UserProfile`).  
- Embedded workouts with fast access.  
- Independent feedback collection for analytics.  

It is optimized for **daily workout generation, fuzzy logic-based adaptation, and long-term fitness trend analysis**.
